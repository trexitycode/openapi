post:
  operationId: getSimpleRate
  tags: [Shipping Rates]
  summary: Simple rate
  description: |
    **(CHANGE AS OF DEC 1, 2022)** All `scheduledPostAt` values must be within **8:00am-1:00pm and 1:00pm-5:00pm local time (inclusive)**.

    Additionally, `scheduledPostAt` cannot be set to a value within the current time window or in the past. A time window is current when
    the local time of the pickup address enters the time window.

    For example: If the current time is 9AM local time, then you can only set `scheduledPostAt` to 1PM or later on the same day.

    For example: If the current time is 2PM local time, then you can only set `scheduledPostAt` to 8AM or later the following day.

    You can still schedule in the future, but the `scheduledPostAt` value needs to be within one of the time windows described above.

    When getting a rate for an ASAP shipment `estimateScheduledPostAt` in the response will be set to the start of the next time window.

    ---

    Calculate the rate for a direct shipment from a single pickup address to a
    single delivery address.

    Returns the estimated distance (in meters), estimated travel duration (in
    seconds), and fee from the pickup address to the delivery address.

    If no `pickupAddress` is specified then the merchant's business address will
    be used as the pickup address.

    **(ADDED IN v1.7)** Review the [Usage Policy](/#section/Usage-Policy).

    **(ADDED IN v1.8)** Use this endpoint for direct shipment rates (single pickup
    address and single delivery address), and use the new [Complex Rate](/#operation/createComplexRateRequest)
    endpoint for multiple delivery addresses.

    The rate response will now include estimates for post, pickup, and delivery time.
    Additionally, the new properties `pickupAfter`, `deliverAfter` and `deliverBefore` can be provided to indicate a
    delivery window. Otheriwse the next available delivery window (i.e. ASAP) is assumed. Use the estimated scheduled post
    date in the response when creating the shipment.

    ---

    ### Examples

    Because the `pickupAfter`, `deliverAfter`, and `deliverBefore` are pickup and delivery time constraints, and there
    is a time window constraint on values for `scheduledPostAt` you will need to do to the math yourself before submitting
    to this API when specifying a pickup or delivery time constraint by taking into consideration of the delivery duration
    from pickup and adding **2 hours (this may change at a later time)** to allow for a driver to arrive at pickup.

    If `deliverBefore` is "2022-11-23T12:00:00.000-05:00" and the delivery duration from pickup to drop off is estimated to be 30 minutes,
    then `estimateScheduledPostAt` will be "2022-11-23T09:30:00.000-05:00".

    **NOTE: The estimated timings in the response will be rounded to intervals of 30 minutes.**

  x-codeSamples:
    - $ref: ../../code_samples/Shell/simple-rate/post.yaml

  ##############################################################################

  requestBody:
    description: Payload that minimally describes a direct shipment.
    required: true
    content:
      application/json:
        schema:
          $ref: ../../components/schemas/payloads/SimpleRatePayload.yaml
        example:
          pickupAddress: '456 Elgin Street, Ottawa ON K2P 1N5, CA'
          deliveryAddress: '225 Preston St, Ottawa ON K1R 7R1, CA'
          requirements:
            legalAgeAlcohol: true
          orderValue: 2500
  responses:
    '200':
      description: Success
      content:
        application/json:
          schema:
            $ref: ../../components/schemas/responses/SimpleRateResponse.yaml
          examples:
            Can Deliver:
              value:
                data:
                  - $ref: ../../components/examples/rate1.yaml
    '400':
      description: Input error
      content:
        application/json:
          schema:
            type: object
            properties:
              error: { type: string, nullable: true }
              params: { type: object, nullable: true }
              code:
                type: string
                nullable: true
                description: |
                  Unexhaustive list of codes.

                  - `invalid-merchant-requirements` = When the requirements specified don't match the requirements granted to the merchant
                  - `pickup-address-unserviceable` = When the pickup address cannot be matched to any of the merchant's locations
                  - `invalid-pickup-address` = When the pickup address is invalid
                  - `pickup-point-outside-zone` = When the pickup address is outside Trexity's service area
                  - `invalid-data-payload` = When there are issues with the input data provided
                  - `num-labels-too-large` = When numLabels is too large
                  - `num-labels-too-large` = When numLabels is too large
                  - `time-constraint-violation` = When the delivery/pickup time constraints specified cannot be met
    '401':
      description: Unauthorized
    '403':
      description: Forbidden
    '404':
      description: No rates
      content:
        application/json:
          schema:
            type: object
            properties:
              data:
                type: array
                minItems: 0
                maxItems: 0
                items:
                  $ref: ../../components/schemas/SimpleRate.yaml
              error:
                type: object
                properties:
                  message: { type: string }
                  code:
                    type: string
                    description: |
                      Unexhaustive list of codes.

                      - `service-unavailable` = When API Service Availability Rules in merchant portal prevent rates from being returned
                      - `time-constraint-violation` = When the constraint specified by pickupAfter, or deliverAfter and/or deliverBefore cannot be met
                      - `post-date-outside-operating-hours` = When the estimated post date is outside Trexity's or the merchant's operating hours
                      - `delivery-date-outside-operating-hours` = When the estimated delivery date is outside Trexity's or the merchant's operating hours
                      - `pickup-address-outsidetaxboundary` = When the pickup address is outside the province/state of the merchant's location
                      - `merchant-disabled` = When the merchant account has been disabled
                      - `missing-profile-details` = When the merchant profile is incomplete
                      - `delivery-point-outside-zone` = When the delivery address is outside Trexity's service area
                      - `pickup-point-outside-zone` = When the pickup address is outside Trexity's service area
    '500':
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              error: { type: string, nullable: true }
