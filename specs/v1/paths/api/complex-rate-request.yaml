post:
  operationId: createComplexRateRequest
  tags: [Shipping Rates]
  summary: Create complex rate request
  description: |
    **(CHANGE AS OF DEC 1, 2022)** All `scheduledPostAt` values must be within **8:00am-1:00pm and 1:00pm-5:00pm local time (inclusive)**.

    Additionally, `scheduledPostAt` cannot be set to a value within the current time window or in the past. A time window is current when
    the local time of the pickup address enters the time window.

    For example: If the current time is 9AM local time, then you can only set `scheduledPostAt` to 1PM or later on the same day.

    For example: If the current time is 2PM local time, then you can only set `scheduledPostAt` to 8AM or later the following day.

    You can still schedule in the future, but the `scheduledPostAt` value needs to be within one of the time windows described above.

    ---

    Queue a list of shipments for an optimally routed rate.

    The typical use case of this API is to provide multiple shipments (pickup &
    delivery) to this endpoint, which responds with a request ID to be polled
    asynchronously using the [Complex Rate status](/#operation/getComplexRateStatus)
    endpoint, and ultimately retrieving the rate using the [Complex Rate result](/#operation/getComplexRateResult)
    endpoint.

    Optionally, you can then take the rate ID provided in the rate result and
    have the shipments created in bulk using the [Bulk Shipment Creation](/#operation/createCreateBulkShipmentsRequest)
    endpoint.

    **Order ID**

    For each parcel across all shipments provided to this endpoint, the
    `orderId` must be unique. This allows us to refer back to the parcel by
    `orderId` in the result `errors` array.

  ##############################################################################

  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          required: [shipments]
          properties:
            locationId:
              type: string
              description: Optionally attach a Location to this request. Will be set to default if not specified. Please see [Locations](#tag/getLocations).
            shipments:
              type: array
              minItems: 1
              maxItems: 400
              items:
                $ref: ../../components/schemas/payloads/DirectShipmentPayload.yaml

  responses:
    '200':
      description: Successfully queued an asynchronous complex rate request
      content:
        application/json:
          schema:
            type: object
            properties:
              data:
                $ref: ../../components/schemas/responses/ComplexRateStatusResponse.yaml
    '400':
      description: Invalid input provided
      content:
        application/json:
          schema:
            type: object
            required: [error]
            properties:
              error: { type: string }
    '500':
      description: Unknown server problem
