get:
  parameters:
    - in: query
      name: fromDate
      schema:
        $ref: ../../components/schemas/SimplifiedDateISOString.yaml
    - in: query
      name: toDate
      schema:
        $ref: ../../components/schemas/SimplifiedDateISOString.yaml
    - in: query
      name: externalId
      schema:
        type: string
        maxLength: 256
        description: |
          **(added in v1.2)** The ID of the external entity that is associated to this parcel (e.g. the external order or shipment ID).
    - in: query
      name: merchantPpid
      deprecated: true
      description: |
        **(deprecated in v1.1)**
      schema:
        type: string

  tags:
    - Shipments
  summary: Gets an array of shipments.
  operationId: getShipments
  description: |
    Gets all Merchant shipments created between the two specified dates.

    ## Filtering By Dates

    When filtering by a date range both the `fromDate` and `toDate` query parameters must be provided.

    ## Filtering By External ID

    When filtering by a parcel's external ID you **cannot filter by dates**. Filtering by dates and external ID are mutually exclusive filters. If `externalId` is specified it will take precendence.
    **(added in v1.2)**

    ## ~~Filtering By Parcel Metadata~~

    ~~Parcel metadata fields can be filtered on by using query parameters with the following pattern `meta_{fieldName}`.~~

    ~~Additionally, the metadata field must have been saved as a string, and not a number for example. This is required since
    the query parameter value is not converted to a number.~~

    ~~Example: `https://{server-url}/shipments?meta_partnerShipmentId=someid`~~
    **(deprecated in v1.2)**
  x-codeSamples:
    - $ref: ../../code_samples/Shell/shipments/get-shipments.yaml
  responses:
    '200':
      description: Success
      content:
        application/json:
          schema:
            type: object
            properties:
              data:
                type: array
                items:
                  $ref: ../../components/schemas/Shipment.yaml
          examples:
            Success:
              value:
                data:
                  - id: TRX904577741-T88
                    requirements: {}
                    merchantId: owr4aM8QVqV90MjgyvQT8dWlLeA3
                    driverId: null
                    directionsResult: null
                    gdprRedacted: false
                    archived: false
                    currentStatus: ''
                    pickupAddress: '60 McLeod Street, Ottawa ON, CA'
                    pickupNotes: Please be careful since it's fragile!
                    pickupAddressLocation: null
                    pickupAddressProvince: ''
                    pickupAddressCountry: ''
                    pickupAddressCity: ''
                    pickupAddressServiceCity: ''
                    cachedDriverName: null
                    cachedTotalRouteDistance: null
                    cachedTotalRouteDuration: null
                    cachedTotalWithoutTaxes: null
                    cachedTaxes: null
                    cachedMerchantAddress: '9 Slack Road, Nepean ON, CA'
                    merchantPpid: null
                    merchantName: TOP KEK Clearing House
                    merchantPhone: +1 555 123 1234
                    merchantEmail: testemail@testing.com
                    createdAt: "2020-07-26T13:50:07.368Z"
                    driverAcceptedAt: null
                    driverStartedAt: null
                    driverArrivedPickupAt: null
                    driverPickedUpAt: null
                    scheduledPostAt: null
                    postedAt: null
                    lastBroadcastedAt: null
                    driverTimeToPickup: null
                    cancellationAcknowledgedByDriver: false
                    scheduledPostError: ''
                    postErrors: []
                    currentDriverEstimatedSecondsToPickup: null
                    parcels:
                      - driverDeliveredAt: null
                        deliveryAddressLocation: null
                        deliveryAddress: '9 Slack Road, Nepean ON, CA'
                        deliveryEmail: new_email@bestemail.org
                        deliveryPhone: ''
                        deliveryName: Felix Hausdorff
                        description: 'Glasses, bifocals'
                        parcelValue: 12300
                        orderId: API-0573
                        isDelivered: false
                      - driverDeliveredAt: null
                        deliveryAddressLocation: null
                        deliveryAddress: '150 Albert St, Ottawa, ON K1P 5G2, Canada'
                        deliveryEmail: ''
                        deliveryPhone: ''
                        deliveryName: Srinivasa Ramanujan
                        description: 'Convergence theorems, 12 pack'
                        parcelValue: 10500
                        orderId: API-1010
                        isDelivered: false
                      - driverDeliveredAt: null
                        deliveryAddressLocation: null
                        deliveryAddress: '20 Colonnade Rd, Nepean, ON K2E 7M6, Canada'
                        deliveryEmail: ''
                        deliveryPhone: ''
                        deliveryName: Carl Friedrich Gauss
                        description: FTOA x 4
                        parcelValue: 19900
                        orderId: API-1020
                        isDelivered: false
                  - id: TRX478723613-XRK
                    requirements: {}
                    merchantId: owr4aM8QVqV90MjgyvQT8dWlLeA3
                    driverId: null
                    directionsResult:
                      type: FeatureCollection
                      features:
                        - type: Feature
                          properties:
                            bounds:
                              southwest:
                                lng: -75.7562437
                                lat: 45.3255523
                              northeast:
                                lng: -75.6894101
                                lat: 45.4115087
                          geometry:
                            type: LineString
                            coordinates:
                              - - -75.69324
                                - 45.41151
                              - - -75.6928
                                - 45.41075
                              - - -75.69262
                                - 45.41045
                              - - -75.69251
                                - 45.41048
                              - - -75.69018
                                - 45.41146
                              - - -75.68944
                                - 45.41062
                              - - -75.68941
                                - 45.41058
                              - - -75.68949
                                - 45.41047
                              - - -75.68956
                                - 45.41034
                              - - -75.68963
                                - 45.41024
                              - - -75.68986
                                - 45.41004
                              - - -75.69054
                                - 45.40964
                              - - -75.69113
                                - 45.40933
                              - - -75.69132
                                - 45.40915
                              - - -75.69173
                                - 45.40896
                              - - -75.69313
                                - 45.40829
                              - - -75.69328
                                - 45.40821
                              - - -75.69437
                                - 45.40771
                              - - -75.69552
                                - 45.40722
                              - - -75.69694
                                - 45.40665
                              - - -75.69845
                                - 45.40609
                              - - -75.69919
                                - 45.40583
                              - - -75.70049
                                - 45.40542
                              - - -75.70143
                                - 45.40514
                              - - -75.70293
                                - 45.40472
                              - - -75.70484
                                - 45.40426
                              - - -75.70631
                                - 45.40392
                              - - -75.70725
                                - 45.40372
                              - - -75.70865
                                - 45.40344
                              - - -75.71113
                                - 45.40297
                              - - -75.71298
                                - 45.40255
                              - - -75.71487
                                - 45.40209
                              - - -75.7153
                                - 45.40195
                              - - -75.71627
                                - 45.40168
                              - - -75.71736
                                - 45.40135
                              - - -75.71837
                                - 45.40101
                              - - -75.71948
                                - 45.40062
                              - - -75.72064
                                - 45.40017
                              - - -75.72133
                                - 45.3999
                              - - -75.72379
                                - 45.39881
                              - - -75.72428
                                - 45.39859
                              - - -75.72658
                                - 45.3975
                              - - -75.72728
                                - 45.39716
                              - - -75.72777
                                - 45.39691
                              - - -75.72832
                                - 45.39657
                              - - -75.729
                                - 45.39608
                              - - -75.72952
                                - 45.39564
                              - - -75.72987
                                - 45.39525
                              - - -75.73081
                                - 45.39412
                              - - -75.73233
                                - 45.39221
                              - - -75.73354
                                - 45.39065
                              - - -75.73407
                                - 45.38994
                              - - -75.73481
                                - 45.38899
                              - - -75.73548
                                - 45.38823
                              - - -75.73614
                                - 45.38752
                              - - -75.73656
                                - 45.38707
                              - - -75.73749
                                - 45.38621
                              - - -75.73832
                                - 45.38544
                              - - -75.73996
                                - 45.38395
                              - - -75.74472
                                - 45.37959
                              - - -75.75079
                                - 45.37402
                              - - -75.75336
                                - 45.37166
                              - - -75.75376
                                - 45.3713
                              - - -75.7539
                                - 45.37128
                              - - -75.75392
                                - 45.37128
                              - - -75.75394
                                - 45.37127
                              - - -75.75397
                                - 45.37125
                              - - -75.75491
                                - 45.37041
                              - - -75.75509
                                - 45.37027
                              - - -75.75523
                                - 45.3702
                              - - -75.75546
                                - 45.37014
                              - - -75.75567
                                - 45.37015
                              - - -75.75585
                                - 45.3702
                              - - -75.75608
                                - 45.37031
                              - - -75.75619
                                - 45.37044
                              - - -75.75624
                                - 45.37058
                              - - -75.75624
                                - 45.37073
                              - - -75.75615
                                - 45.37089
                              - - -75.75604
                                - 45.37099
                              - - -75.75592
                                - 45.37107
                              - - -75.75572
                                - 45.37117
                              - - -75.75511
                                - 45.37134
                              - - -75.7544
                                - 45.37011
                              - - -75.75403
                                - 45.36946
                              - - -75.75364
                                - 45.36876
                              - - -75.7536
                                - 45.36867
                              - - -75.75355
                                - 45.36846
                              - - -75.75335
                                - 45.3681
                              - - -75.75327
                                - 45.36802
                              - - -75.75314
                                - 45.36787
                              - - -75.75296
                                - 45.36772
                              - - -75.75206
                                - 45.36708
                              - - -75.75156
                                - 45.3667
                              - - -75.75121
                                - 45.36641
                              - - -75.75109
                                - 45.36633
                              - - -75.75074
                                - 45.36599
                              - - -75.75033
                                - 45.36566
                              - - -75.74997
                                - 45.36539
                              - - -75.74948
                                - 45.36506
                              - - -75.74847
                                - 45.36453
                              - - -75.74751
                                - 45.36416
                              - - -75.74695
                                - 45.36399
                              - - -75.74648
                                - 45.36388
                              - - -75.74588
                                - 45.36377
                              - - -75.74525
                                - 45.3637
                              - - -75.74443
                                - 45.36364
                              - - -75.74316
                                - 45.36366
                              - - -75.74229
                                - 45.36372
                              - - -75.74167
                                - 45.36379
                              - - -75.74148
                                - 45.36379
                              - - -75.74136
                                - 45.36376
                              - - -75.74123
                                - 45.36369
                              - - -75.74113
                                - 45.36359
                              - - -75.74081
                                - 45.36307
                              - - -75.74017
                                - 45.36197
                              - - -75.7396
                                - 45.36098
                              - - -75.73948
                                - 45.36075
                              - - -75.73923
                                - 45.3604
                              - - -75.73897
                                - 45.3601
                              - - -75.73889
                                - 45.35996
                              - - -75.73845
                                - 45.35922
                              - - -75.73783
                                - 45.35803
                              - - -75.73694
                                - 45.35652
                              - - -75.73631
                                - 45.35542
                              - - -75.73561
                                - 45.35425
                              - - -75.73474
                                - 45.35283
                              - - -75.73459
                                - 45.35257
                              - - -75.73449
                                - 45.35234
                              - - -75.73431
                                - 45.35203
                              - - -75.73339
                                - 45.35053
                              - - -75.73302
                                - 45.34994
                              - - -75.73239
                                - 45.34887
                              - - -75.73178
                                - 45.34782
                              - - -75.73112
                                - 45.34676
                              - - -75.73002
                                - 45.34489
                              - - -75.72905
                                - 45.34325
                              - - -75.72894
                                - 45.34316
                              - - -75.72801
                                - 45.34164
                              - - -75.72782
                                - 45.34131
                              - - -75.72718
                                - 45.34021
                              - - -75.72663
                                - 45.33922
                              - - -75.72641
                                - 45.33882
                              - - -75.72639
                                - 45.33869
                              - - -75.72632
                                - 45.33851
                              - - -75.72569
                                - 45.3374
                              - - -75.72496
                                - 45.33614
                              - - -75.72418
                                - 45.33479
                              - - -75.72401
                                - 45.33444
                              - - -75.72372
                                - 45.33396
                              - - -75.72345
                                - 45.33354
                              - - -75.72281
                                - 45.33246
                              - - -75.72267
                                - 45.33217
                              - - -75.72239
                                - 45.33172
                              - - -75.72209
                                - 45.33111
                              - - -75.72193
                                - 45.33081
                              - - -75.7217
                                - 45.33046
                              - - -75.72132
                                - 45.32977
                              - - -75.72109
                                - 45.32935
                              - - -75.72028
                                - 45.32789
                              - - -75.71961
                                - 45.32672
                              - - -75.71944
                                - 45.32644
                              - - -75.71925
                                - 45.32611
                              - - -75.71932
                                - 45.32595
                              - - -75.71943
                                - 45.32582
                              - - -75.71998
                                - 45.32563
                              - - -75.72007
                                - 45.32555
                              - - -75.72048
                                - 45.32606
                    gdprRedacted: false
                    archived: false
                    currentStatus: WAITING_FOR_ACCEPTANCE
                    pickupAddress: '60 McLeod Street, Ottawa ON, CA'
                    pickupNotes: Please be careful since it's fragile!
                    pickupAddressLocation:
                      latitude: 45.4115087
                      longitude: -75.69323659999999
                    pickupAddressProvince: 'ON'
                    pickupAddressCountry: CA
                    pickupAddressCity: Ottawa
                    pickupAddressServiceCity: Ottawa, ON
                    cachedDriverName: null
                    cachedTotalRouteDistance: 13989
                    cachedTotalRouteDuration: 1969
                    cachedTotalWithoutTaxes: 1486
                    cachedTaxes:
                      HST: 193
                    cachedMerchantAddress: '9 Slack Road, Nepean ON, CA'
                    merchantPpid: null
                    merchantName: TOP KEK Clearing House
                    merchantPhone: +1 555 123 1234
                    merchantEmail: testemail@testing.com
                    createdAt: "2020-07-26T13:50:07.051Z"
                    driverAcceptedAt: null
                    driverStartedAt: null
                    driverArrivedPickupAt: null
                    driverPickedUpAt: null
                    scheduledPostAt: null
                    postedAt: "2020-07-26T13:50:09.681Z"
                    lastBroadcastedAt: null
                    driverTimeToPickup: null
                    cancellationAcknowledgedByDriver: false
                    scheduledPostError: ''
                    postErrors: []
                    currentDriverEstimatedSecondsToPickup: null
                    parcels:
                      - driverDeliveredAt: null
                        deliveryAddressLocation:
                          latitude: 45.326237
                          longitude: -75.7205628
                        deliveryAddress: '9 Slack Road, Nepean ON, CA'
                        deliveryEmail: ''
                        deliveryPhone: ''
                        deliveryName: Felix Hausdorff
                        description: 'Glasses, bifocals'
                        parcelValue: 12300
                        orderId: API-0573
                        deliveryAddressProvince: 'ON'
                        deliveryAddressCountry: CA
                        deliveryAddressCity: Ottawa
                        deliveryAddressServiceCity: Ottawa, ON
                        isDelivered: false

            Fail:
              value:
                data: []

post:
  tags:
    - Shipments
  summary: Create a new Shipment
  description: |
    Creates a new shipment.

    If no `pickupAddress` is specified then the merchant's business address will be used as the pickup address.
  operationId: createShipment
  x-codeSamples:
    - $ref: ../../code_samples/Shell/shipments/create-shipment.yaml
  responses:
    '500':
      description: Unknown server problem
    '400':
      description: Invalid payload or permission denied.
    '200':
      description: Success
      content:
        application/json:
          schema:
            type: object
            properties:
              data:
                type: object
                properties:
                  shipmentId:
                    type: string
          examples:
            Success:
              value:
                data:
                  shipmentId: 'TRX1132313511829' 
  requestBody:
    description: Payload describing your shipment
    required: true
    content:
      application/json:
        schema:
          $ref: ../../components/schemas/payloads/CreateShipmentPayload.yaml
        examples:
          ImmediateInit:
            value:
              pickupAddress: '9 Slack Road, Ottawa ON, CA'
              requirements: {}
              pickupNotes: 'Please be careful, since it may contain fragile things!'
              parcels:
                - deliveryAddress: '123 Slater Street, Ottawa ON, CA'
                  deliveryName: 'Srinivasa Ramanujan'
                  description: 'Glasses, bifocals'
                  orderId: 'BFG10K'
                  parcelValue: 10000
          ScheduledInit:
            value:
              pickupAddress: '123 Slater Street, Ottawa ON, CA'
              requirements: {}
              pickupNotes: 'Please be careful, since it may contain fragile things!'
              scheduledPostAt: '2020-07-25T10:16:11.048Z'
              parcels:
                - deliveryAddress: '100 McLeod St, Ottawa ON, CA'
                  deliveryName: 'Lagrange'
                  description: 'Copy of Newtons Principia Mathematica'
                  orderId: 'NWTNRULZ'
                  parcelValue: 15000

