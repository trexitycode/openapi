post:
  operationId: calculateShipmentRate
  tags: [Rating]
  summary: Calculate shipment rate
  description: |
    Calculate a rate for a shipment.

    If no `pickupAddress` is specified then your primary location's address will
    be used as the pickup address.

    Please review our [Usage Policy](/#section/Usage-Policy) before displaying rates to your customers.

    The rate response will include estimates for post, pickup, and delivery time.

    Additionally, the properties `pickupAfter`, `deliverAfter` and `deliverBefore` can be provided to indicate a
    pickup or delivery window. Otheriwse the next available pickup window (i.e. ASAP) is assumed.

    **Unexhaustive list of error codes.**

    - `invalid-merchant-requirements` = When the requirements specified don't match the requirements granted to the merchant
    - `pickup-address-unserviceable` = When the pickup address cannot be matched to any of the merchant's locations
    - `invalid-pickup-address` = When the pickup address is invalid
    - `pickup-point-outside-zone` = When the pickup address is outside Trexity's service area
    - `invalid-data-payload` = When there are issues with the input data provided
    - `num-labels-too-large` = When numLabels is too large
    - `time-constraint-violation` = When the delivery/pickup time constraints specified cannot be met
    - `service-unavailable` = When API Service Availability Rules in merchant portal prevent rates from being returned
    - `time-constraint-violation` = When the constraint specified by pickupAfter, or deliverAfter and/or deliverBefore cannot be met
    - `post-date-outside-operating-hours` = When the estimated post date is outside Trexity's or the merchant's operating hours
    - `delivery-date-outside-operating-hours` = When the estimated delivery date is outside Trexity's or the merchant's operating hours
    - `pickup-address-outsidetaxboundary` = When the pickup address is outside the province/state of the merchant's location
    - `merchant-disabled` = When the merchant account has been disabled
    - `missing-profile-details` = When the merchant profile is incomplete
    - `delivery-point-outside-zone` = When the delivery address is outside Trexity's service area
    - `pickup-point-outside-zone` = When the pickup address is outside Trexity's service area

  x-codeSamples:
    - $ref: ../../code_samples/Shell/rating/get-delivery-rate.yaml

  requestBody:
    required: true
    content:
      application/json:
        schema:
          $ref: ../../components/schemas/ShipmentRateDTO.yaml

  responses:
    '200':
      description: Success
      content:
        application/json:
          schema:
            type: object
            properties:
              data:
                $ref: ../../components/schemas/ShipmentRateWithETA.yaml

    '400':
      $ref: '../../components/responses/400.yaml'
    '401':
      $ref: '../../components/responses/401.yaml'
    '403':
      $ref: '../../components/responses/403.yaml'
    '500':
      $ref: '../../components/responses/500.yaml'
